{"ast":null,"code":"import { BASE_PATH, apiVersion } from './config';\nimport { ACCESS_TOKEN, REFRESH_TOKEN } from '../Utils/constants';\nimport jwtDecode from 'jwt-decode'; //obtiene access Token\n\nexport function getAccessTokenApi() {\n  //obtiene accessToken de local storage\n  //local storage => inspeccionar/aplicacion/Local Storage\n  const accessToken = localStorage.getItem(ACCESS_TOKEN); //comprueba si el access token ha caducado o no\n  //si ha caducado retorna null\n  //si access token no ha caducado devuelve el access token\n\n  if (!accessToken || accessToken === \"null\") {\n    return null;\n  } //si devuelve true ha expirado y en consola devuelve null. \n  //Si devuelve false no ha expirado y devuelve el access token en consola\n\n\n  return willExpireToken(accessToken) ? null : accessToken;\n}\nexport function getRefreshTokenApi() {\n  //obtiene refreshToken de local storage\n  //local storage => inspeccionar/aplicacion/Local Storage\n  const refreshToken = localStorage.getItem(REFRESH_TOKEN);\n\n  if (!refreshToken || refreshToken === \"null\") {\n    return null;\n  }\n\n  return willExpireToken(refreshToken) ? null : refreshToken;\n}\n\nfunction willExpireToken(token) {\n  const seconds = 60; //decodifica el token\n\n  const metaToken = jwtDecode(token);\n  const {\n    exp\n  } = metaToken; //obtiene la fecha de hoy para realizar comparacion con el token\n\n  const now = (Date.now() + seconds) / 1000; // si now es mayor que la fecha de expiracion el token ha caducado\n\n  return now > exp; //devuelve true si token expiro y false si no ha expirado\n}\n\nexport function refreshAccessTokenApi(refreshToken) {\n  const url = `${BASE_PATH}/${apiVersion}/refresh-access-token`;\n  const bodyObject = {\n    refreshToken: refreshToken\n  };\n  const params = {\n    method: \"POST\",\n    body: JSON.stringify(bodyObject),\n    mode: 'no-cors',\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  };\n  fetch(url, params).then(response => {\n    if (response.status !== 200) {\n      return null;\n    }\n\n    return response.json();\n  }).then(result => {\n    if (!result) {\n      logOut();\n    } else {\n      const {\n        accessToken,\n        refreshToken\n      } = result;\n      localStorage.setItem(ACCESS_TOKEN, accessToken);\n      localStorage.setItem(REFRESH_TOKEN, refreshToken);\n    }\n  });\n} //funcion para deslogear al usuario\n//lo que hace es literalemente borrar los tokens del local storage\n\nexport function logOut() {\n  localStorage.removeItem(ACCESS_TOKEN);\n  localStorage.removeItem(REFRESH_TOKEN);\n}","map":{"version":3,"sources":["/Users/kenneth/Documents/Proyecto-Web-Completo/DivudiciCliente/src/Api/auth.js"],"names":["BASE_PATH","apiVersion","ACCESS_TOKEN","REFRESH_TOKEN","jwtDecode","getAccessTokenApi","accessToken","localStorage","getItem","willExpireToken","getRefreshTokenApi","refreshToken","token","seconds","metaToken","exp","now","Date","refreshAccessTokenApi","url","bodyObject","params","method","body","JSON","stringify","mode","headers","fetch","then","response","status","json","result","logOut","setItem","removeItem"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,UAApB,QAAsC,UAAtC;AACA,SAASC,YAAT,EAAuBC,aAAvB,QAA4C,oBAA5C;AACA,OAAOC,SAAP,MAAsB,YAAtB,C,CAEA;;AACA,OAAO,SAASC,iBAAT,GAA6B;AAChC;AACA;AACA,QAAMC,WAAW,GAAGC,YAAY,CAACC,OAAb,CAAqBN,YAArB,CAApB,CAHgC,CAIhC;AACA;AACA;;AACA,MAAI,CAACI,WAAD,IAAgBA,WAAW,KAAK,MAApC,EAA4C;AACxC,WAAO,IAAP;AACH,GAT+B,CAUhC;AACA;;;AACA,SAAOG,eAAe,CAACH,WAAD,CAAf,GAA+B,IAA/B,GAAsCA,WAA7C;AAEH;AACD,OAAO,SAASI,kBAAT,GAA8B;AACjC;AACA;AACA,QAAMC,YAAY,GAAGJ,YAAY,CAACC,OAAb,CAAqBL,aAArB,CAArB;;AACA,MAAI,CAACQ,YAAD,IAAiBA,YAAY,KAAK,MAAtC,EAA8C;AAC1C,WAAO,IAAP;AACH;;AACD,SAAOF,eAAe,CAACE,YAAD,CAAf,GAAgC,IAAhC,GAAuCA,YAA9C;AACH;;AACD,SAASF,eAAT,CAAyBG,KAAzB,EAAgC;AAC5B,QAAMC,OAAO,GAAG,EAAhB,CAD4B,CAE5B;;AACA,QAAMC,SAAS,GAAGV,SAAS,CAACQ,KAAD,CAA3B;AAEA,QAAM;AAAEG,IAAAA;AAAF,MAAUD,SAAhB,CAL4B,CAM5B;;AACA,QAAME,GAAG,GAAG,CAACC,IAAI,CAACD,GAAL,KAAaH,OAAd,IAAyB,IAArC,CAP4B,CAQ5B;;AACA,SAAOG,GAAG,GAAGD,GAAb,CAT4B,CAU5B;AACH;;AACD,OAAO,SAASG,qBAAT,CAA+BP,YAA/B,EAA6C;AAChD,QAAMQ,GAAG,GAAI,GAAEnB,SAAU,IAAGC,UAAW,uBAAvC;AACA,QAAMmB,UAAU,GAAG;AACfT,IAAAA,YAAY,EAAEA;AADC,GAAnB;AAGA,QAAMU,MAAM,GAAG;AACXC,IAAAA,MAAM,EAAE,MADG;AAEXC,IAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeL,UAAf,CAFK;AAGXM,IAAAA,IAAI,EAAE,SAHK;AAIXC,IAAAA,OAAO,EAAE;AACL,sBAAgB;AADX;AAJE,GAAf;AAQAC,EAAAA,KAAK,CAACT,GAAD,EAAME,MAAN,CAAL,CACKQ,IADL,CACUC,QAAQ,IAAI;AACd,QAAIA,QAAQ,CAACC,MAAT,KAAoB,GAAxB,EAA6B;AACzB,aAAO,IAAP;AACH;;AACD,WAAOD,QAAQ,CAACE,IAAT,EAAP;AACH,GANL,EAOKH,IAPL,CAOUI,MAAM,IAAI;AACZ,QAAI,CAACA,MAAL,EAAa;AACTC,MAAAA,MAAM;AACT,KAFD,MAEO;AACH,YAAM;AAAE5B,QAAAA,WAAF;AAAeK,QAAAA;AAAf,UAAgCsB,MAAtC;AACA1B,MAAAA,YAAY,CAAC4B,OAAb,CAAqBjC,YAArB,EAAmCI,WAAnC;AACAC,MAAAA,YAAY,CAAC4B,OAAb,CAAqBhC,aAArB,EAAoCQ,YAApC;AACH;AACJ,GAfL;AAgBH,C,CACD;AACA;;AACA,OAAO,SAASuB,MAAT,GAAkB;AACrB3B,EAAAA,YAAY,CAAC6B,UAAb,CAAwBlC,YAAxB;AACAK,EAAAA,YAAY,CAAC6B,UAAb,CAAwBjC,aAAxB;AACH","sourcesContent":["import { BASE_PATH, apiVersion } from './config';\nimport { ACCESS_TOKEN, REFRESH_TOKEN } from '../Utils/constants'\nimport jwtDecode from 'jwt-decode'\n\n//obtiene access Token\nexport function getAccessTokenApi() {\n    //obtiene accessToken de local storage\n    //local storage => inspeccionar/aplicacion/Local Storage\n    const accessToken = localStorage.getItem(ACCESS_TOKEN);\n    //comprueba si el access token ha caducado o no\n    //si ha caducado retorna null\n    //si access token no ha caducado devuelve el access token\n    if (!accessToken || accessToken === \"null\") {\n        return null;\n    }\n    //si devuelve true ha expirado y en consola devuelve null. \n    //Si devuelve false no ha expirado y devuelve el access token en consola\n    return willExpireToken(accessToken) ? null : accessToken;\n\n}\nexport function getRefreshTokenApi() {\n    //obtiene refreshToken de local storage\n    //local storage => inspeccionar/aplicacion/Local Storage\n    const refreshToken = localStorage.getItem(REFRESH_TOKEN);\n    if (!refreshToken || refreshToken === \"null\") {\n        return null\n    }\n    return willExpireToken(refreshToken) ? null : refreshToken;\n}\nfunction willExpireToken(token) {\n    const seconds = 60;\n    //decodifica el token\n    const metaToken = jwtDecode(token);\n\n    const { exp } = metaToken;\n    //obtiene la fecha de hoy para realizar comparacion con el token\n    const now = (Date.now() + seconds) / 1000;\n    // si now es mayor que la fecha de expiracion el token ha caducado\n    return now > exp;\n    //devuelve true si token expiro y false si no ha expirado\n}\nexport function refreshAccessTokenApi(refreshToken) {\n    const url = `${BASE_PATH}/${apiVersion}/refresh-access-token`\n    const bodyObject = {\n        refreshToken: refreshToken\n    }\n    const params = {\n        method: \"POST\",\n        body: JSON.stringify(bodyObject),\n        mode: 'no-cors',\n        headers: {\n            \"Content-Type\": \"application/json\"\n        }\n    };\n    fetch(url, params)\n        .then(response => {\n            if (response.status !== 200) {\n                return null;\n            }\n            return response.json();\n        })\n        .then(result => {\n            if (!result) {\n                logOut();\n            } else {\n                const { accessToken, refreshToken } = result;\n                localStorage.setItem(ACCESS_TOKEN, accessToken);\n                localStorage.setItem(REFRESH_TOKEN, refreshToken);\n            }\n        })\n}\n//funcion para deslogear al usuario\n//lo que hace es literalemente borrar los tokens del local storage\nexport function logOut() {\n    localStorage.removeItem(ACCESS_TOKEN);\n    localStorage.removeItem(REFRESH_TOKEN);\n}\n\n"]},"metadata":{},"sourceType":"module"}